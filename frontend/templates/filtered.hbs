<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="filtered.css"> 
    <title>Filtered Recipes</title>
</head>
<body>
    <nav class="navbar">
        <div id="userProfile">
            {{#if user.profile_picture}}
                <img src="/uploads/{{user.profile_picture}}" alt="Profile Picture" id="profilePicture">
                <a href="/" id="logoutLink">Logout</a>
            {{else}}
                <p></p>
            {{/if}}
        </div>
        
        <button id="generateMealsBtn">View Recipes</button>
    </nav>

    <div id="mealsContainer"></div>
    <div id="mealPlanContainer"></div>

    <script>
          // Add event listener to the generateMealPlan button
       document.getElementById('generateMealPlan').addEventListener('click', async () => {
            try {

                // Fetch the meal plan
                const response = await fetch('/meal_plan', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }

                
                const data = await response.json();
                displayMealPlan(data.mealPlan);
                console.log('Meal Plan:', data.mealPlan);
            } catch (error) {
                console.error('Error fetching meal plan:', error);
            }
        });

         // Function to display the meal plan
        function displayMealPlan(mealPlan) {
            const mealPlanContainer = document.getElementById('mealPlanContainer');
            mealPlanContainer.innerHTML = ''; // Clear previous meal plan

            const mealTypes = ['breakfast', 'lunch', 'dinner'];
            
            mealTypes.forEach(mealType => {
                const mealTypeDiv = document.createElement('div');
                mealTypeDiv.className = 'meal-type';
                mealTypeDiv.innerHTML = `<h2>${mealType.charAt(0).toUpperCase() + mealType.slice(1)}</h2>`;

                mealPlan[mealType].forEach(meal => {
                    if (meal) {
                        const mealDiv = document.createElement('div');
                        mealDiv.className = 'meal';
                        mealDiv.innerHTML = `
                            <h3>${meal.title}</h3>
                            <img src="${meal.image}" alt="${meal.title}" style="width:200px;">
                            <p><strong>Used Ingredients:</strong> ${meal.usedIngredients ? meal.usedIngredients.map(i => i.name).join(', ') : 'N/A'}</p>
                            <p><strong>Missed Ingredients:</strong> ${meal.missedIngredients ? meal.missedIngredients.map(i => i.name).join(', ') : 'N/A'}</p>
                        `;
                        mealTypeDiv.appendChild(mealDiv);
                    } else {
                        mealTypeDiv.innerHTML += '<p>No meal planned</p>';
                    }
                });

                mealPlanContainer.appendChild(mealTypeDiv);
            });
        }


      
        // Display the meals on the page
        document.getElementById('generateMealsBtn').addEventListener('click', async () => {
            try {
                const response = await fetch('/filter_meals', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }

                const data = await response.json();
                console.log('Meals:', data.meals);

                // Display the meals on the page
                const mealsContainer = document.getElementById('mealsContainer');
                mealsContainer.innerHTML = ''; // Clear previous meals

                data.meals.forEach(meal => {
                    const mealDiv = document.createElement('div');
                    mealDiv.innerHTML = `
                        <h3>${meal.title}</h3>
                        <img src="${meal.image}" alt="${meal.title}" style="width:200px;">
                        <p><strong>Used Ingredients:</strong> ${meal.usedIngredients.map(i => `${i.name} (${i.amount} ${i.unit})`).join(', ')}</p>
                        <p><strong>Missed Ingredients:</strong> ${meal.missedIngredients.map(i => `${i.name} (${i.amount} ${i.unit})`).join(', ')}</p>
                        <p><strong>Instructions:</strong> ${meal.instructions}</p>
                    `;
                    
                    mealsContainer.appendChild(mealDiv);
                });
            } catch (error) {
                console.error('Error:', error);
            }
        });

        // Toggle logout link visibility
        document.getElementById('profilePicture').addEventListener('click', () => {
            const logoutLink = document.getElementById('logoutLink');
            logoutLink.style.display = logoutLink.style.display === 'block' ? 'none' : 'block';
        });
    </script>
</body>
</html>
